"use strict";var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var DBHelper=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"openDB",value:function(){if("indexedDB"in window)return idb.open("restaurants-app",1,function(e){switch(e.oldVersion){case 0:e.createObjectStore("restaurants",{keyPath:"id"}).createIndex("name","id",{unique:!0});case 1:e.createObjectStore("outbox",{autoIncrement:!0,keyPath:"id"})}});console.log("This browser doesn't support IndexedDB")}},{key:"addRestaurants",value:function(r){return this.openDB().then(function(e){var t=e.transaction("restaurants","readwrite"),n=t.objectStore("restaurants");return Promise.all(r.map(function(e){return n.put(e)})).catch(function(e){t.abort(),console.error(e)})}).catch(function(e){return console.error(e)})}},{key:"fetchRestaurantsFromServer",value:function(){var n=this;return new Promise(function(t,e){fetch(n.DATABASE_URL).then(function(e){t(e.json())})})}},{key:"fetchRestaurants",value:function(){var t=this;return this.openDB().then(function(e){return e.transaction("restaurants","readwrite").objectStore("restaurants").getAll()}).then(function(e){return e&&0!==e.length?e:t.fetchRestaurantsFromServer().then(function(e){return t.addRestaurants(e),e}).catch(function(e){return console.error(e)})})}},{key:"fetchRestaurantFromServerById",value:function(n){var r=this;return new Promise(function(t,e){fetch(r.DATABASE_URL+"/"+n).then(function(e){return t(e.json())})}).catch(function(e){return console.error(e)})}},{key:"fetchAllRestaurantReviews",value:function(){var n=this;return new Promise(function(t,e){fetch(""+n.REVIEWS_URL).then(function(e){return t(e.json())})}).catch(function(e){return console.error(e)})}},{key:"fetchRestaurantReviews",value:function(n){var r=this;return new Promise(function(t,e){fetch(r.REVIEWS_URL+"/?restaurant_id="+n).then(function(e){return t(e.json())})}).catch(function(e){return console.error(e)})}},{key:"fetchReviewById",value:function(n){var r=this;return new Promise(function(t,e){fetch(r.REVIEWS_URL+"/"+n).then(function(e){return t(e.json())})}).catch(function(e){return console.error(e)}).then(function(e){return console.table(e)})}},{key:"addRestaurantReview",value:function(e){return fetch(this.REVIEWS_URL+"/",{method:"POST",body:e}).then(function(e){return e.json()}).catch(function(e){return console.error(e)})}},{key:"removeRestaurantReview",value:function(e){return fetch(this.REVIEWS_URL+"/"+e,{method:"DELETE"})}},{key:"editRestaurantReview",value:function(e,t){return fetch(this.REVIEWS_URL+"/"+e,{method:"PUT",body:t})}},{key:"fetchRestaurantById",value:function(t){var n=this;return this.openDB().then(function(e){return e.transaction("restaurants","readonly").objectStore("restaurants").index("name").get(parseInt(t))}).then(function(e){return e||n.fetchRestaurantFromServerById(t)})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){return"img/"+e.id+".jpg"}},{key:"srcsetUrlSmallForRestaurant",value:function(e){return"/responsive-images/"+e.id+"-320_small_2x.jpg 2x, /responsive-images/"+e.id+"-160_small_1x.jpg 1x"}},{key:"srcsetUrlMediumForRestaurant",value:function(e){return"/responsive-images/"+e.id+"-640_medium_2x.jpg 2x, /responsive-images/"+e.id+"-320_medium_1x.jpg 1x"}},{key:"imageAltForRestaurants",value:function(e){return"Restaurant "+e.name+" in "+e.neighborhood}},{key:"mapMarkerForRestaurant",value:function(e,t){var n=new google.maps.Marker({position:e.latlng,title:e.name,url:this.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP});return setTimeout(function(){var e=document.getElementsByClassName("gm-style");e[0]&&(e[0].children[1].setAttribute("title","Google map with the restaurants location"),e[0].children[1].contentWindow.document.childNodes[0].setAttribute("lang","en"))},1e3),n}},{key:"favorRestaurant",value:function(e){var n=this;fetch("http://localhost:1337/restaurants/"+self.restaurant.id+"/?is_favorite=true",{method:"PUT"}).then(function(e){return e.json()}).then(function(t){return n.openDB().then(function(e){return e.transaction("restaurants","readwrite").objectStore("restaurants").put(t).complete})}).catch(function(e){return console.error(e)})}},{key:"unfavorRestaurant",value:function(e){var n=this;fetch("http://localhost:1337/restaurants/"+self.restaurant.id+"/?is_favorite=false",{method:"PUT"}).then(function(e){return e.json()}).then(function(t){return n.openDB().then(function(e){return e.transaction("restaurants","readwrite").objectStore("restaurants").put(t).complete})}).catch(function(e){return console.error(e)})}},{key:"DATABASE_URL",get:function(){return"https://reviews-staging.herokuapp.com/restaurants"}},{key:"REVIEWS_URL",get:function(){return"https://reviews-staging.herokuapp.com/reviews"}}]),e}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIl0sIm5hbWVzIjpbIkRCSGVscGVyIiwid2luZG93IiwiaWRiIiwib3BlbiIsInVwZ3JhZGVEYiIsIm9sZFZlcnNpb24iLCJjcmVhdGVPYmplY3RTdG9yZSIsImtleVBhdGgiLCJjcmVhdGVJbmRleCIsInVuaXF1ZSIsImNvbnNvbGUiLCJhdXRvSW5jcmVtZW50IiwibG9nIiwidHgiLCJkYiIsInRyYW5zYWN0aW9uIiwic3RvcmUiLCJvYmplY3RTdG9yZSIsIlByb21pc2UiLCJhbGwiLCJyZXN0YXVyYW50cyIsIm1hcCIsIml0ZW0iLCJkYlByb21pc2UiLCJwdXQiLCJjYXRjaCIsImVyciIsImFib3J0IiwiZXJyb3IiLCJfdGhpcyIsInRoaXMiLCJyZXNvbHZlIiwicmVqZWN0IiwiZmV0Y2giLCJEQVRBQkFTRV9VUkwiLCJ0aGVuIiwicmVzdWx0IiwianNvbiIsIl90aGlzMiIsIm9wZW5EQiIsImdldEFsbCIsImxlbmd0aCIsImFkZFJlc3RhdXJhbnRzIiwiZmV0Y2hSZXN0YXVyYW50c0Zyb21TZXJ2ZXIiLCJpZCIsIl90aGlzMyIsIl90aGlzNCIsIlJFVklFV1NfVVJMIiwiX3RoaXM1IiwiX3RoaXM2IiwicHJvbWlzZSIsInJlc3BvbnNlIiwidGFibGUiLCJyZXZpZXciLCJtZXRob2QiLCJib2R5IiwiaW5kZXgiLCJnZXQiLCJwYXJzZUludCIsInJlc3RhdXJhbnQiLCJfdGhpczciLCJmZXRjaFJlc3RhdXJhbnRGcm9tU2VydmVyQnlJZCIsIm5hbWUiLCJuZWlnaGJvcmhvb2QiLCJtYXJrZXIiLCJnb29nbGUiLCJtYXBzIiwiTWFya2VyIiwicG9zaXRpb24iLCJsYXRsbmciLCJ0aXRsZSIsInVybCIsImFuaW1hdGlvbiIsIkRST1AiLCJzZXRUaW1lb3V0IiwiZnJhbWVzIiwiZG9jdW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJjaGlsZHJlbiIsImNvbnRlbnRXaW5kb3ciLCJjaGlsZE5vZGVzIiwiX3RoaXM4Iiwic2VsZiIsInJlcyIsImNvbXBsZXRlIiwiX3RoaXM5IiwiaW5uZXJEb2N1bWVudCJdLCJtYXBwaW5ncyI6ImlZQUVBQSxvSEFNTUEsR0FBQUEsY0FNbUJDLE9BUWYsT0FIWUMsSUFBSUMsS0FBSyxrQkFBbUIsRUFBRyxTQUFBQyxHQUMvQyxPQUFRQSxFQUFVQyxZQUNoQixLQUFLLEVBQ1NELEVBQVVFLGtCQUFrQixjQUFlLENBWi9EQyxRQUFBLE9BZWNDLFlBQVksT0FBUSxLQUFNLENBQUVDLFFBQVEsSUFYaEQsS0FBTSxFQUNKQyxFQUFZSixrQkFBQSxTQUFBLENBQ1pLLGVBQUEsRUFDREosUUFBQSxVQUZDRyxRQUFRRSxJQUFJLGlGQWFFTixHQUNSSyxPQUFBQSxLQUFBQSxTQUNBSixLQUFBQSxTQUFBQSxHQUZvQyxJQUFBTSxFQUF0Q0MsRUFBQUMsWUFBQSxjQUFBLGFBUkpDLEVBQUFILEVBQUFJLFlBQUEsZUFERixPQUFBQyxRQUFBQyxJQTRCTUMsRUFBWUMsSUFBSSxTQUFBQyxHQVp0QixPQUFPQyxFQUFQQyxJQUFBRixNQWVNRyxNQUFNLFNBQUFDLEdBWmRiLEVBQUFjLFFBY1FqQixRQUFRa0IsTUFBTUYsT0FHakJELE1BQU0sU0FBQUMsR0FBQSxPQUFPaEIsUUFBUWtCLE1BQU1GLDBEQXFCaEMsSUFBQUcsRUFBQUMsS0FVRSxPQUxjLElBQUlaLFFBQVEsU0FBQ2EsRUFBU0MsR0FDbENDLE1BQU1KLEVBQUtLLGNBQWNDLEtBQUssU0FBQUMsR0FDNUJMLEVBQVFLLEVBQU9DLHVEQU1yQixJQUFBQyxFQUFBUixLQU9FLE9BQU9BLEtBQUtTLFNBQ1RKLEtBQUssU0FBQXJCLEdBQUEsT0FDSkEsRUFDR0MsWUFBWSxjQUFlLGFBQzNCRSxZQUFZLGVBQ1p1QixXQUVKTCxLQUFLLFNBQUFmLEdBUmdCLE9BQUFBLEdBQUEsSUFBQUEsRUFBQXFCLE9BWVRDLEVBRkZKLEVBQUtLLDZCQVRYUixLQUFLSSxTQUFBQSxHQU9KLE9BTkFELEVBRUR2QixlQUFZSyxHQUlYQSxJQUVGSyxNQUFPLFNBQUFDLEdBQUEsT0FBS2lCLFFBQUFBLE1BQUFBLDZEQVFuQkMsR0FBQSxJQUFBQyxFQUFBZixLQVdDLE9BTGMsSUFBSVosUUFBUSxTQUFDYSxFQUFTQyxHQUp0Q0MsTUFBQVksRUFBQVgsYUFBQSxJQUFBVSxHQUFBVCxLQUFBLFNBQUFDLEdBQUEsT0FNTUwsRUFBUUssRUFBT0MsWUFFaEJaLE1BQU0sU0FBQUMsR0FBQSxPQUFPaEIsUUFBUWtCLE1BQU1GLHlEQUg1QixJQUFBb0IsRUFBQWhCLEtBR08sT0FGTEMsSUFBQUEsUUFBUUssU0FBQUEsRUFEK0JKLEdBQUFDLE1BQUFBLEdBQXpDYSxFQUFBQyxhQUFBWixLQUFBLFNBQUFDLEdBQUEsT0FBQUwsRUFBQUssRUFBQUMsWUFEWVosTUFJWEEsU0FBQUEsR0FBQUEsT0FBTWYsUUFBQWtCLE1BQUFGLG9EQWlCbUJrQixHQUFJLElBQUFJLEVBQUFsQixLQVZDLE9BV25CLElBQUlaLFFBQVEsU0FBQ2EsRUFBU0MsR0FDbENDLE1BQVNlLEVBQUtELFlBQWQsbUJBQTRDSCxHQUFNVCxLQUFLLFNBQUFDLEdBQUEsT0FDckRMLEVBQVFLLEVBQU9DLFlBRWhCWixNQUFNLFNBQUFDLEdBQUEsT0FBT2hCLFFBQVFrQixNQUFNRiw2Q0FackJrQixHQUFBLElBQUFLLEVBQUFuQixLQUVWLE9BRmlCcEIsSUFBQUEsUUFBY2dCLFNBQUFBLEVBQXJCTSxHQUFBQyxNQUZUZ0IsRUFBQUYsWUFFUyxJQUZUSCxHQUFBVCxLQUFBLFNBQUFDLEdBQUEsT0FBQUwsRUFBQUssRUFBQUMsWUFHQVosTUFBT3lCLFNBQUFBLEdBQUFBLE9BQVB4QyxRQUFBa0IsTUFBQUYsS0FBQVMsS0FBQSxTQUFBZ0IsR0FBQSxPQUFBekMsUUFBQTBDLE1BQUFELGlEQTRCeUJFLEdBQ3pCLE9BQU9wQixNQUFTSCxLQUFLaUIsWUFBZCxJQUE4QixDQUNuQ08sT0FBUSxPQXhCc0JDLEtBQUFGLElBMEI3QmxCLEtBQUssU0FBQWdCLEdBQUEsT0FBWUEsRUFBU2QsU0F6QjdCWixNQUFJeUIsU0FBQUEsR0FBQUEsT0FBQUEsUUFBY2hDLE1BQVFRLG9EQUExQmtCLEdBS0EsT0FBQVgsTUFBQUgsS0FBQWlCLFlBQUEsSUFBQUgsRUFBQSxDQUNEVSxPQUFBLHdEQW1DMkJWLEVBQUlTLEdBQzlCLE9BQU9wQixNQUFTSCxLQUFLaUIsWUFBZCxJQS9Ca0JILEVBQUEsQ0FBQVUsT0FBQSxNQWlDdkJDLEtBQU1GLGdEQTlCMkRGLEdBQUFBLElBQUFBLEVBQUFBLEtBQTFCLE9BRnpDckIsS0FBQVMsU0FHQUosS0FBQSxTQUFBckIsR0EyQ0ksT0ExQ0xBLEVBQUFDLFlBQUEsY0FBQSxZQXdDb0JFLFlBQVksZUF0Q2pDdUMsTUFBQSxRQXdDbUJDLElBQUlDLFNBQVNkLE1BRTNCVCxLQUFLLFNBQUF3QixHQUNKLE9BQUtBLEdBQ0lDLEVBQUtDLDhCQUE4QmpCLDhDQXhDaERlLEdBS0QsTUFBQSx3QkFBQUEsRUFBQWYsaURBbUQ0QmUsR0FDM0IsTUFBQSxPQUFjQSxFQUFXZixHQUF6QiwyREE3Q1VlLEdBRGdDLE1BQUEsc0JBRzNDQSxFQUFBZixHQUgyQyw0Q0FLNUNlLEVBQUFmLEdBTDRDLDRFQXlEUmUsR0FDbEMsTUFBQSxzQkFDRUEsRUFBV2YsR0FEYiw2Q0FoREVVLEVBQVFWLEdBZ0RWLHVFQU80QmUsR0FsRDlCLE1BQUEsY0FBQUEsRUFBQUcsS0FBQSxPQUFBSCxFQUFBSSw0REF5RDhCSixFQXJEQ3RDLEdBQUEsSUFBQTJDLEVBQUEsSUFBQUMsT0FBQUMsS0FBQUMsT0FBQSxDQXVEM0JDLFNBQVVULEVBQVdVLE9BdER2QkMsTUFBT1gsRUFBQUcsS0FFSFMsSUFBQXpDLEtBQUlqQixpQkFBb0I4QyxHQUN4QnRDLElBQUFBLEVBQ0FtRCxVQUFJaEIsT0FBUXhDLEtBQU13QyxVQUFsQmlCLE9Bb0VKLE9BaEVJQyxXQUFLZixXQUNILElBQUFnQixFQUFPQyxTQUFLZix1QkFBQUEsWUFDYmMsRUFBQSxLQUNEQSxFQUFPaEIsR0FBQUEsU0FBUCxHQUFBa0IsYUFYSixRQWFELDRDQUVERixFQUFBLEdBQUFHLFNBQUEsR0FBQUMsY0FBQUgsU0FzRG9CSSxXQUFXLEdBQUdILGFBQWEsT0FBUSxRQUVsRCxLQUNJYiwwQ0FsRFRwQixHQUFBLElBQUFxQyxFQUFBbkQsS0F5REVHLE1BQUFBLHFDQUVJaUQsS0FBS3ZCLFdBQVdmLEdBRnBCLHFCQUlFLENBQ0VVLE9BQVEsUUFHVG5CLEtBQUssU0FBQWdELEdBQUEsT0FBT0EsRUFBSTlDLFNBQ2hCRixLQUFLLFNBQUF3QixHQUNKLE9BQU9zQixFQUFLMUMsU0FBU0osS0FBSyxTQUFBckIsR0FLeEIsT0FoRU5BLEVBS0RDLFlBQUEsY0FBQSxhQXlEVUUsWUFBWSxlQUNaTyxJQUFJbUMsR0FDR3lCLGFBR2IzRCxNQUFNLFNBQUFDLEdBQUEsT0FBT2hCLFFBQVFrQixNQUFNRiwrQ0FoRGhDa0IsR0FBQSxJQUFBeUMsRUFBQXZELEtBdURFRyxNQUFBQSxxQ0FFSWlELEtBQUt2QixXQUFXZixHQUZwQixzQkFJRSxDQUNFVSxPQUFRLFFBdERWZ0IsS0FBQUEsU0FBQUEsR0FBQUEsT0FBT1gsRUFBQUEsU0FDUFksS0FBQUEsU0FBQUEsR0FDQWxELE9BQUtBLEVBSitCa0IsU0FBQUosS0FBQSxTQUFBckIsR0FTcEMsT0FKV21ELEVBTGJsRCxZQUFBLGNBQUEsYUFnRVNFLFlBQVksZUF4RHJCeUQsSUFBV2YsR0FDTGdCLGFBTUZsRCxNQUFBLFNBQUFDLEdBQUEsT0FBSTRELFFBQUFBLE1BQWdCWCwwQ0FuTmxCOUQsTUFBQUEsd0ZBc0JOLE1BQU8iLCJmaWxlIjoiZGJoZWxwZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKmVzbGludC1kaXNhYmxlIG5vLXVudXNlZC12YXJzKi9cclxuLypnbG9iYWwgZ29vZ2xlLCBpZGIgKi9cclxuLyplc2xpbnQgbGluZWJyZWFrLXN0eWxlOiBbXCJlcnJvclwiLCBcIndpbmRvd3NcIl0qL1xyXG5cclxuLyoqXHJcbiAqIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxyXG4gKi9cclxuXHJcbmNsYXNzIERCSGVscGVyIHtcclxuICBcclxuICAvKipcclxuICAgKiBJbmRleERCIGluc3RhbmNlLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBvcGVuREIoKSB7XHJcbiAgICBpZiAoISgnaW5kZXhlZERCJyBpbiB3aW5kb3cpKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdUaGlzIGJyb3dzZXIgZG9lc25cXCd0IHN1cHBvcnQgSW5kZXhlZERCJyk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBkYlByb21pc2UgPSBpZGIub3BlbigncmVzdGF1cmFudHMtYXBwJywgMSwgdXBncmFkZURiID0+IHtcclxuICAgICAgc3dpdGNoICh1cGdyYWRlRGIub2xkVmVyc2lvbikge1xyXG4gICAgICAgIGNhc2UgMDpcclxuICAgICAgICAgIHZhciBzdG9yZSA9IHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZSgncmVzdGF1cmFudHMnLCB7XHJcbiAgICAgICAgICAgIGtleVBhdGg6ICdpZCdcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgc3RvcmUuY3JlYXRlSW5kZXgoJ25hbWUnLCAnaWQnLCB7IHVuaXF1ZTogdHJ1ZSB9KTtcclxuICAgICAgICAvKmVzbGludC1kaXNhYmxlIG5vLWZhbGx0aHJvdWdoKi9cclxuICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICB1cGdyYWRlRGIuY3JlYXRlT2JqZWN0U3RvcmUoJ291dGJveCcsIHtcclxuICAgICAgICAgICAgYXV0b0luY3JlbWVudDogdHJ1ZSxcclxuICAgICAgICAgICAga2V5UGF0aDogJ2lkJ1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBkYlByb21pc2U7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBZGRpbmcgcmVzdGF1cmFudHMgdG8gdGhlIGluZGV4ZWREQi5cclxuICAgKi9cclxuICBzdGF0aWMgYWRkUmVzdGF1cmFudHMocmVzdGF1cmFudHMpIHtcclxuICAgIHJldHVybiB0aGlzLm9wZW5EQigpXHJcbiAgICAgIC50aGVuKGRiID0+IHtcclxuICAgICAgICB2YXIgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgICAgdmFyIHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJyk7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFxyXG4gICAgICAgICAgcmVzdGF1cmFudHMubWFwKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gc3RvcmUucHV0KGl0ZW0pO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICApLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgICB0eC5hYm9ydCgpO1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZXJyID0+IGNvbnNvbGUuZXJyb3IoZXJyKSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBEYXRhYmFzZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XHJcbiAgICBjb25zdCBwb3J0ID0gMTMzNzsgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxyXG4gICAgLy8gcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vcmVzdGF1cmFudHNgO1xyXG4gICAgcmV0dXJuICdodHRwczovL3Jldmlld3Mtc3RhZ2luZy5oZXJva3VhcHAuY29tL3Jlc3RhdXJhbnRzJztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldmlld3MgVVJMLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXQgUkVWSUVXU19VUkwoKSB7XHJcbiAgICBjb25zdCBwb3J0ID0gMTMzNzsgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxyXG4gICAgLy8gcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vcmV2aWV3c2A7XHJcbiAgICByZXR1cm4gJ2h0dHBzOi8vcmV2aWV3cy1zdGFnaW5nLmhlcm9rdWFwcC5jb20vcmV2aWV3cyc7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMuXHJcbiAgICovXHJcblxyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzRnJvbVNlcnZlcigpIHtcclxuICAgIGxldCBwcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICBmZXRjaCh0aGlzLkRBVEFCQVNFX1VSTCkudGhlbihyZXN1bHQgPT4ge1xyXG4gICAgICAgIHJlc29sdmUocmVzdWx0Lmpzb24oKSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gcHJvbWlzZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFdlIGdldCBhbiBhY2Nlc3MgdG8gdGhlIGluZGV4ZWREQiBhbmQgZmV0Y2ggcmVzdGF1cmFudHMuXHJcbiAgICogSWYgcmVzdGF1cmFudHMgYXJlIG5vdCBjaGFjaGVkLCB3ZSBmZXRjaCB0aGVuIGZyb20gdGhlIHNlcnZlclxyXG4gICAqIGFuZCBhZGQgdG8gdGhlIG9iamVjdFN0b3JlLlxyXG4gICAqL1xyXG5cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50cygpIHtcclxuICAgIHJldHVybiB0aGlzLm9wZW5EQigpXHJcbiAgICAgIC50aGVuKGRiID0+XHJcbiAgICAgICAgZGJcclxuICAgICAgICAgIC50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJylcclxuICAgICAgICAgIC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKVxyXG4gICAgICAgICAgLmdldEFsbCgpXHJcbiAgICAgIClcclxuICAgICAgLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgICAgIGlmICghcmVzdGF1cmFudHMgfHwgcmVzdGF1cmFudHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICByZXR1cm4gdGhpcy5mZXRjaFJlc3RhdXJhbnRzRnJvbVNlcnZlcigpXHJcbiAgICAgICAgICAgIC50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgICAgICAgICB0aGlzLmFkZFJlc3RhdXJhbnRzKHJlc3RhdXJhbnRzKTtcclxuICAgICAgICAgICAgICByZXR1cm4gcmVzdGF1cmFudHM7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5lcnJvcihlcnIpKTtcclxuICAgICAgICB9IGVsc2UgcmV0dXJuIHJlc3RhdXJhbnRzO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGEgcmVzdGF1cmFudCBieSBpdHMgSUQgZnJvbSB0aGUgc2VydmVyLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRGcm9tU2VydmVyQnlJZChpZCkge1xyXG4gICAgbGV0IHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIGZldGNoKGAke3RoaXMuREFUQUJBU0VfVVJMfS8ke2lkfWApLnRoZW4ocmVzdWx0ID0+XHJcbiAgICAgICAgcmVzb2x2ZShyZXN1bHQuanNvbigpKVxyXG4gICAgICApO1xyXG4gICAgfSkuY2F0Y2goZXJyID0+IGNvbnNvbGUuZXJyb3IoZXJyKSk7XHJcbiAgICByZXR1cm4gcHJvbWlzZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCByZXN0YXVyYW50IHJldmlld3NcclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hBbGxSZXN0YXVyYW50UmV2aWV3cygpIHtcclxuICAgIGxldCBwcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICBmZXRjaChgJHt0aGlzLlJFVklFV1NfVVJMfWApLnRoZW4ocmVzdWx0ID0+IHJlc29sdmUocmVzdWx0Lmpzb24oKSkpO1xyXG4gICAgfSkuY2F0Y2goZXJyID0+IGNvbnNvbGUuZXJyb3IoZXJyKSk7XHJcbiAgICByZXR1cm4gcHJvbWlzZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGEgcmVzdGF1cmFudCByZXZpZXdzXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudFJldmlld3MoaWQpIHtcclxuICAgIGxldCBwcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICBmZXRjaChgJHt0aGlzLlJFVklFV1NfVVJMfS8/cmVzdGF1cmFudF9pZD0ke2lkfWApLnRoZW4ocmVzdWx0ID0+XHJcbiAgICAgICAgcmVzb2x2ZShyZXN1bHQuanNvbigpKVxyXG4gICAgICApO1xyXG4gICAgfSkuY2F0Y2goZXJyID0+IGNvbnNvbGUuZXJyb3IoZXJyKSk7XHJcbiAgICByZXR1cm4gcHJvbWlzZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGMgYSByZXZpZXcgYnkgaWRcclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXZpZXdCeUlkKGlkKSB7XHJcbiAgICBsZXQgcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgZmV0Y2goYCR7dGhpcy5SRVZJRVdTX1VSTH0vJHtpZH1gKS50aGVuKHJlc3VsdCA9PiByZXNvbHZlKHJlc3VsdC5qc29uKCkpKTtcclxuICAgIH0pLmNhdGNoKGVyciA9PiBjb25zb2xlLmVycm9yKGVycikpLnRoZW4ocmVzcG9uc2UgPT4gY29uc29sZS50YWJsZShyZXNwb25zZSkpO1xyXG4gICAgcmV0dXJuIHByb21pc2U7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBQb3N0IGEgcmVzdGF1cmFudCByZXZpZXdcclxuICAgKi9cclxuICBzdGF0aWMgYWRkUmVzdGF1cmFudFJldmlldyhyZXZpZXcpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLlJFVklFV1NfVVJMfS9gLCB7XHJcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICBib2R5OiByZXZpZXdcclxuICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKVxyXG4gICAgLmNhdGNoKGVyciA9PiBjb25zb2xlLmVycm9yKGVycikpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGVsZXRlIGEgcmVzdGF1cmFudCByZXZpZXdcclxuICAgKi9cclxuICBzdGF0aWMgcmVtb3ZlUmVzdGF1cmFudFJldmlldyhpZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuUkVWSUVXU19VUkx9LyR7aWR9YCwge1xyXG4gICAgICBtZXRob2Q6ICdERUxFVEUnXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEVkaXQgYSByZXN0YXVyYW50IHJldmlld1xyXG4gICAqL1xyXG4gIHN0YXRpYyBlZGl0UmVzdGF1cmFudFJldmlldyhpZCwgcmV2aWV3KSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5SRVZJRVdTX1VSTH0vJHtpZH1gLCB7XHJcbiAgICAgIG1ldGhvZDogJ1BVVCcsXHJcbiAgICAgIGJvZHk6IHJldmlld1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgZnJvbSB0aGUgaW5kZXhlZERCLCBpZiBpdCBoYXMgYmVlbiBjYWNoZWQuXHJcbiAgICovXHJcblxyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkKSB7XHJcbiAgICByZXR1cm4gdGhpcy5vcGVuREIoKVxyXG4gICAgICAudGhlbihkYiA9PiB7XHJcbiAgICAgICAgdmFyIHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJywgJ3JlYWRvbmx5Jyk7XHJcbiAgICAgICAgdmFyIHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJyk7XHJcbiAgICAgICAgdmFyIGluZGV4ID0gc3RvcmUuaW5kZXgoJ25hbWUnKTtcclxuICAgICAgICByZXR1cm4gaW5kZXguZ2V0KHBhcnNlSW50KGlkKSk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgICAgIGlmICghcmVzdGF1cmFudCkge1xyXG4gICAgICAgICAgcmV0dXJuIHRoaXMuZmV0Y2hSZXN0YXVyYW50RnJvbVNlcnZlckJ5SWQoaWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdGF1cmFudDtcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxyXG4gICAqL1xyXG4gIHN0YXRpYyB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiBgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiBgaW1nLyR7cmVzdGF1cmFudC5pZH0uanBnYDtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBzcmNzZXRVcmxTbWFsbEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIGAvcmVzcG9uc2l2ZS1pbWFnZXMvJHtcclxuICAgICAgcmVzdGF1cmFudC5pZFxyXG4gICAgfS0zMjBfc21hbGxfMnguanBnIDJ4LCAvcmVzcG9uc2l2ZS1pbWFnZXMvJHtcclxuICAgICAgcmVzdGF1cmFudC5pZFxyXG4gICAgfS0xNjBfc21hbGxfMXguanBnIDF4YDtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBzcmNzZXRVcmxNZWRpdW1Gb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiBgL3Jlc3BvbnNpdmUtaW1hZ2VzLyR7XHJcbiAgICAgIHJlc3RhdXJhbnQuaWRcclxuICAgIH0tNjQwX21lZGl1bV8yeC5qcGcgMngsIC9yZXNwb25zaXZlLWltYWdlcy8ke1xyXG4gICAgICByZXN0YXVyYW50LmlkXHJcbiAgICB9LTMyMF9tZWRpdW1fMXguanBnIDF4YDtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBpbWFnZUFsdEZvclJlc3RhdXJhbnRzKHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiBgUmVzdGF1cmFudCAke3Jlc3RhdXJhbnQubmFtZX0gaW4gJHtyZXN0YXVyYW50Lm5laWdoYm9yaG9vZH1gO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxyXG4gICAqL1xyXG4gIHN0YXRpYyBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xyXG4gICAgY29uc3QgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgIHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcclxuICAgICAgdGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcclxuICAgICAgdXJsOiB0aGlzLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXHJcbiAgICAgIG1hcDogbWFwLFxyXG4gICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QXHJcbiAgICB9KTtcclxuXHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgdmFyIGZyYW1lcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2dtLXN0eWxlJyk7XHJcbiAgICAgIGlmIChmcmFtZXNbMF0pIHtcclxuICAgICAgICBmcmFtZXNbMF0uY2hpbGRyZW5bMV0uc2V0QXR0cmlidXRlKFxyXG4gICAgICAgICAgJ3RpdGxlJyxcclxuICAgICAgICAgICdHb29nbGUgbWFwIHdpdGggdGhlIHJlc3RhdXJhbnRzIGxvY2F0aW9uJ1xyXG4gICAgICAgICk7XHJcbiAgICAgICAgdmFyIGlubmVyRG9jdW1lbnQgPSBmcmFtZXNbMF0uY2hpbGRyZW5bMV0uY29udGVudFdpbmRvdy5kb2N1bWVudDtcclxuICAgICAgICBpbm5lckRvY3VtZW50LmNoaWxkTm9kZXNbMF0uc2V0QXR0cmlidXRlKCdsYW5nJywgJ2VuJyk7XHJcbiAgICAgIH1cclxuICAgIH0sIDEwMDApO1xyXG4gICAgcmV0dXJuIG1hcmtlcjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldCByZXN0YXVyYW50IGFzIGZhdm9yaXRlXHJcbiAgICovXHJcbiAgc3RhdGljIGZhdm9yUmVzdGF1cmFudChpZCkge1xyXG4gICAgZmV0Y2goXHJcbiAgICAgIGBodHRwOi8vbG9jYWxob3N0OjEzMzcvcmVzdGF1cmFudHMvJHtcclxuICAgICAgICBzZWxmLnJlc3RhdXJhbnQuaWRcclxuICAgICAgfS8/aXNfZmF2b3JpdGU9dHJ1ZWAsXHJcbiAgICAgIHtcclxuICAgICAgICBtZXRob2Q6ICdQVVQnXHJcbiAgICAgIH1cclxuICAgIClcclxuICAgICAgLnRoZW4ocmVzID0+IHJlcy5qc29uKCkpXHJcbiAgICAgIC50aGVuKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm9wZW5EQigpLnRoZW4oZGIgPT4ge1xyXG4gICAgICAgICAgY29uc3QgdHggPSBkYlxyXG4gICAgICAgICAgICAudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJywgJ3JlYWR3cml0ZScpXHJcbiAgICAgICAgICAgIC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKVxyXG4gICAgICAgICAgICAucHV0KHJlc3RhdXJhbnQpO1xyXG4gICAgICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZXJyID0+IGNvbnNvbGUuZXJyb3IoZXJyKSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZW1vdmUgZmF2b3JpdGUgc3RhdHVzIG9mZiBhIHJlc3RhdXJhbnRcclxuICAgKi9cclxuICBzdGF0aWMgdW5mYXZvclJlc3RhdXJhbnQoaWQpIHtcclxuICAgIGZldGNoKFxyXG4gICAgICBgaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jlc3RhdXJhbnRzLyR7XHJcbiAgICAgICAgc2VsZi5yZXN0YXVyYW50LmlkXHJcbiAgICAgIH0vP2lzX2Zhdm9yaXRlPWZhbHNlYCxcclxuICAgICAge1xyXG4gICAgICAgIG1ldGhvZDogJ1BVVCdcclxuICAgICAgfVxyXG4gICAgKVxyXG4gICAgICAudGhlbihyZXMgPT4gcmVzLmpzb24oKSlcclxuICAgICAgLnRoZW4ocmVzdGF1cmFudCA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMub3BlbkRCKCkudGhlbihkYiA9PiB7XHJcbiAgICAgICAgICBjb25zdCB0eCA9IGRiXHJcbiAgICAgICAgICAgIC50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJylcclxuICAgICAgICAgICAgLm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpXHJcbiAgICAgICAgICAgIC5wdXQocmVzdGF1cmFudCk7XHJcbiAgICAgICAgICByZXR1cm4gdHguY29tcGxldGU7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5lcnJvcihlcnIpKTtcclxuICB9XHJcbn1cclxuIl19
